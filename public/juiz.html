<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Juiz Imparcial - Veredito Final</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Georgia:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Georgia', serif; }
        .theme-color { color: #a0785a; }
        .theme-bg { background-color: #a0785a; }
        .theme-border { border-color: #a0785a; }
        .theme-bg-hover:hover { background-color: #8c6147; }
        #modal { transition: opacity 0.3s ease; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

<div class="container bg-white p-8 rounded-lg shadow-xl max-w-4xl w-full">
    <header class="text-center mb-8 pb-4 border-b-4 theme-border">
        <h1 class="text-4xl font-bold theme-color">üèõÔ∏è O Juiz Imparcial üèõÔ∏è</h1>
        <p class="text-lg italic text-gray-600 mt-2">Um tribunal neutro para resolver suas disputas.</p>
    </header>

    <!-- √ÅREA INICIAL DO FORMUL√ÅRIO -->
    <div id="formArea">
        <p class="mb-6 text-center">Apresentem o caso. Descrevam o contexto da disputa e, em seguida, cada parte deve apresentar seus argumentos de forma clara e objetiva.</p>
        <div class="mb-6">
            <label for="disputeContext" class="block font-bold mb-2 text-lg text-center theme-color">Contexto da Disputa:</label>
            <textarea id="disputeContext" placeholder="Descreva a situa√ß√£o ou o problema central..." class="w-full p-3 border border-gray-300 rounded-md h-28 resize-none focus:ring-2 focus:ring-amber-600"></textarea>
        </div>
        <div class="case-section grid md:grid-cols-2 gap-6 mb-6">
            <div class="party bg-gray-50 p-6 rounded-lg border border-gray-200">
                <h2 class="text-2xl font-bold mb-4 text-center theme-color">Parte 1</h2>
                <label for="nameA" class="block font-bold mb-1">Nome:</label>
                <input type="text" id="nameA" placeholder="Seu nome" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-amber-600">
                <label for="argumentA" class="block font-bold mt-4 mb-1">Argumento:</label>
                <textarea id="argumentA" placeholder="Explique seu ponto de vista..." class="w-full p-2 border border-gray-300 rounded-md h-48 resize-none focus:ring-2 focus:ring-amber-600"></textarea>
            </div>
            <div class="party bg-gray-50 p-6 rounded-lg border border-gray-200">
                <h2 class="text-2xl font-bold mb-4 text-center theme-color">Parte 2</h2>
                <label for="nameB" class="block font-bold mb-1">Nome:</label>
                <input type="text" id="nameB" placeholder="Nome da outra parte" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-amber-600">
                <label for="argumentB" class="block font-bold mt-4 mb-1">Argumento:</label>
                <textarea id="argumentB" placeholder="Explique o ponto de vista da outra parte." class="w-full p-2 border border-gray-300 rounded-md h-48 resize-none focus:ring-2 focus:ring-amber-600"></textarea>
            </div>
        </div>
        <div class="text-center mt-6">
            <button id="submitBtn" onclick="submitCase()" class="theme-bg text-white font-bold py-3 px-8 rounded-lg text-lg theme-bg-hover transition-colors shadow-md hover:shadow-lg disabled:bg-gray-400">Submeter para Julgamento</button>
        </div>
    </div>

    <!-- √ÅREA DE PERGUNTAS DO JUIZ -->
    <div id="questionArea" class="hidden">
        <h2 class="text-2xl font-bold theme-color text-center mb-4">O Juiz Requer Esclarecimentos</h2>
        <div class="bg-amber-50 p-6 rounded-lg border-l-4 theme-border mb-6">
            <p class="font-bold text-lg">Pergunta do Juiz:</p>
            <p id="judgeQuestionText" class="italic text-gray-700 mt-2"></p>
        </div>
        <div class="grid md:grid-cols-2 gap-6 mb-6">
            <div>
                <label for="respostaA" id="labelRespostaA" class="block font-bold mb-1">Resposta da Parte 1:</label>
                <textarea id="respostaA" class="w-full p-2 border border-gray-300 rounded-md h-32 resize-none focus:ring-2 focus:ring-amber-600"></textarea>
            </div>
            <div>
                <label for="respostaB" id="labelRespostaB" class="block font-bold mb-1">Resposta da Parte 2:</label>
                <textarea id="respostaB" class="w-full p-2 border border-gray-300 rounded-md h-32 resize-none focus:ring-2 focus:ring-amber-600"></textarea>
            </div>
        </div>
        <div class="text-center mt-6">
            <button id="submitResponseBtn" onclick="submitResponse()" class="theme-bg text-white font-bold py-3 px-8 rounded-lg text-lg theme-bg-hover transition-colors shadow-md hover:shadow-lg disabled:bg-gray-400">Enviar Respostas e Continuar</button>
        </div>
    </div>

    <!-- √ÅREA DE DELIBERA√á√ÉO (LOADING) -->
    <div id="loading" class="hidden text-center py-10">
        <h2 class="text-3xl font-bold theme-color animate-pulse">Deliberando... ‚öñÔ∏è</h2>
        <p class="mt-4 text-lg">O Juiz est√° analisando o caso.</p>
    </div>

    <!-- √ÅREA DO VEREDITO FINAL -->
    <div id="verdict" class="hidden text-center py-10">
        <h2 class="text-3xl font-bold theme-color mb-4">O Tribunal Chegou a um Veredito</h2>
        <p class="mb-6">Ap√≥s considera√ß√£o, a decis√£o √© a seguinte:</p>
        <p class="text-2xl font-bold text-green-600 mb-6" id="winnerName"></p>
        <div class="bg-gray-50 p-6 rounded-lg border-l-8 theme-border text-left italic" id="reasoningText"></div>
        <p class="mt-8 text-sm text-gray-500"><i>Lembre-se: o objetivo √© quebrar o impasse, n√£o criar conflito. Caso encerrado.</i></p>
        <button onclick="resetCourt()" class="mt-8 theme-bg text-white font-bold py-2 px-6 rounded-lg theme-bg-hover transition-colors shadow-md hover:shadow-lg">Iniciar Novo Julgamento</button>
    </div>
</div>

<!-- MODAL DE ALERTA -->
<div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50" onclick="closeModal()">
    <div class="bg-white rounded-lg shadow-2xl p-8 max-w-sm w-full text-center" onclick="event.stopPropagation()">
        <h3 class="text-xl font-bold mb-4 theme-color">Aten√ß√£o</h3>
        <p id="modal-text" class="mb-6"></p>
        <button id="modal-close-btn" class="theme-bg text-white font-bold py-2 px-6 rounded-lg theme-bg-hover">Entendido</button>
    </div>
</div>

<script>
    // --- Gerenciamento de Estado da Aplica√ß√£o ---
    let conversationHistory = [];
    let caseData = {};

    // --- Elementos do DOM ---
    const formArea = document.getElementById('formArea');
    const questionArea = document.getElementById('questionArea');
    const loading = document.getElementById('loading');
    const verdict = document.getElementById('verdict');
    const modal = document.getElementById('modal');
    const modalText = document.getElementById('modal-text');
    const modalCloseBtn = document.getElementById('modal-close-btn');

    // --- Fun√ß√µes do Modal ---
    function showModal(message) {
        modalText.textContent = message;
        modal.classList.remove('hidden');
    }
    function closeModal() {
        modal.classList.add('hidden');
    }
    modalCloseBtn.addEventListener('click', closeModal);

    // --- Fun√ß√µes de UI ---
    function showSection(section) {
        formArea.style.display = 'none';
        questionArea.style.display = 'none';
        loading.style.display = 'none';
        verdict.style.display = 'none';
        section.style.display = 'block';
    }

    // --- L√≥gica Principal ---
    function submitCase() {
        caseData = {
            disputeContext: document.getElementById('disputeContext').value.trim(),
            nameA: document.getElementById('nameA').value.trim(),
            argumentA: document.getElementById('argumentA').value.trim(),
            nameB: document.getElementById('nameB').value.trim(),
            argumentB: document.getElementById('argumentB').value.trim(),
        };
        if (!caseData.disputeContext || !caseData.nameA || !caseData.argumentA || !caseData.nameB || !caseData.argumentB) {
            showModal("Todos os campos iniciais devem ser preenchidos.");
            return;
        }
        callJudge();
    }

    function submitResponse() {
        const respostaA = document.getElementById('respostaA').value.trim();
        const respostaB = document.getElementById('respostaB').value.trim();
        if (!respostaA || !respostaB) {
            showModal("Ambas as partes devem responder √† pergunta do Juiz.");
            return;
        }
        const lastTurn = conversationHistory[conversationHistory.length - 1];
        lastTurn.respostas = { respostaA, respostaB };
        callJudge();
    }

    async function callJudge() {
        showSection(loading);
        const functionUrl = 'https://getverdict-rly7palgja-uc.a.run.app';
        const payload = { ...caseData, historico: conversationHistory };

        try {
            const response = await fetch(functionUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({ error: 'Erro desconhecido do servidor.' }));
                throw new Error(errorData.error || `Erro ${response.status}: ${response.statusText}`);
            }

            const result = await response.json();

            if (result.status === 'veredito') {
                deliverVerdict(result.vencedor, result.justificativa);
            } else if (result.status === 'pergunta') {
                conversationHistory.push({ juiz: result.pergunta });
                askQuestion(result.pergunta);
            } else {
                throw new Error('Resposta do tribunal em formato inesperado.');
            }
        } catch (error) {
            console.error("Erro na chamada da fun√ß√£o:", error);
            deliverVerdict("Erro", error.message);
        }
    }

    function askQuestion(question) {
        document.getElementById('judgeQuestionText').innerText = question;
        document.getElementById('labelRespostaA').innerText = `Resposta de ${caseData.nameA}:`;
        document.getElementById('labelRespostaB').innerText = `Resposta de ${caseData.nameB}:`;
        document.getElementById('respostaA').value = '';
        document.getElementById('respostaB').value = '';
        showSection(questionArea);
    }

    function deliverVerdict(winner, reason) {
        const winnerNameEl = document.getElementById('winnerName');
        const reasoningTextEl = document.getElementById('reasoningText');

        if (winner === "Erro" || (winner !== caseData.nameA && winner !== caseData.nameB)) {
            winnerNameEl.innerText = "Ocorreu um Erro no Julgamento";
            winnerNameEl.className = 'text-2xl font-bold text-red-600 mb-6';
            reasoningTextEl.innerText = reason;
        } else {
            winnerNameEl.innerText = `${winner} apresentou o argumento mais forte!`;
            winnerNameEl.className = 'text-2xl font-bold text-green-600 mb-6';
            reasoningTextEl.innerText = `Justificativa: ${reason}`; 
        }
        showSection(verdict);
    }

    function resetCourt() {
        location.reload();
    }
</script>

</body>
</html>
